<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Thêm viewport để tối ưu hóa di động -->
    <title>越南语听力练习</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            margin: 0; 
            padding-bottom: 300px; /* Mặc định cho màn hình lớn */
            background-color: #f7fbf3; /*f7fbf3  3f4040*/
        }
        #gameContainer {
            display: block;
            min-height: calc(100vh - 150px); /* Đảm bảo nội dung chiếm đủ chiều cao màn hình */
        }
        #infoBox { 
            width: 95%; 
            max-width: 700px;
            min-height: 100px; 
            margin: 0 auto; 
            border: 2px solid #91b66f; /*041b31 1f4263*/
            background: #85ae5f; /*ecf2e4 fefefc*/
            color: #ffffff; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 90%; 
            max-width: 700px;
            min-height: 25px; 
            margin: 0px auto; 
            border: 2px solid #91b66f; 
            background: #85ae5f; 
            color: #f1c232; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(16px, 2vw, 20px); 
            font-weight: bold;
        }
        #instructionBox { 
            width: 90%; 
            max-width: 700px;
            min-height: 25px; 
            margin: 0px auto; 
            border: 2px solid #91b66f; 
            background: #85ae5f; 
            color: #f7e19c; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(16px, 2vw, 20px); 
            font-weight: bold;
        }
        #controls { 
            position: fixed; /* Cố định ở cuối màn hình */
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px; /* Giới hạn chiều rộng tối đa */
            background: #f7fbf3;
                        border: 3px solid #f7fbf3;                        
            padding: 10px 0; 
           /* box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2); */
            z-index: 1000; 
        }
        #controls div {
            margin: 5px 0; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        button { 
            padding: 8px 8px; 
            margin: 0 5px; 
            cursor: pointer; 
            border: 2px solid #85ae5f; 
            background: #85ae5f; /*192332*/
                        box-shadow: 0 5px 5px rgba(0, 0, 0, 0.2);
            color: #fffbef; 
            font-size: 28px; 
            border-radius: 5px; 
        }
        #sentenceNumber { 
            width: 50px; 
            padding: 10px; 
            text-align: center; 
            border: 3px solid #85ae5f; /*041b31 68838B*/
            background: #f1cc76; 
            color: #000; 
            border-radius: 10px; 
            font-size: 16px; 
            -moz-appearance: textfield; 
        }
        #sentenceNumber::-webkit-inner-spin-button, 
        #sentenceNumber::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        #sentenceNumber:disabled { 
            background: #eee; 
        }
        .disabled { 
            cursor: not-allowed; 
            pointer-events: none; 
        }
        .active-mode { 
            border: 2px solid #fed16a; 
        }
        #indicator { 
            width: 95%;
                        max-width: 700px; 
            min-height: 50px; 
            margin: 10px auto; 
                        padding: 5px;
            border: 3px solid #fed16a; 
            background: #ffffe0; 
            border-radius: 10px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        #optionsContainer {
            width: 100%;
            max-width: 700px;
            margin: 10px auto;
        }
        .optionBtn {
            width: 95%; 
            max-width: 700px;
            padding: 10px;
            margin: 5px 0;
            border: 2px solid #ffffff;
            background: #ffffff; /*E6EDD9*/
            color: #000000;
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 30px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
        }
        .optionBtn:hover {
            background: #D2E4C4;
        }
        .correct {
            background: #B7D7AA !important;
        }
        .wrong {
            background: #CE6D5E !important;
        }
        #score { 
            display: none; 
            width: 100%;
            max-width: 700px;
            margin: 10px auto; 
            color: #FF6820; 
            font-size: 30px; 
            text-align: center;
        }
        #wrongSentences { 
            display: none; 
            width: 95%; 
            max-width: 700px; 
            margin: 10px auto; 
            padding: 10px; 
            border: 2px solid #CE6D5E; 
            background: #FFF0F0; 
            color: #CE6D5E; 
            font-size: 30px; 
            text-align: left; 
            border-radius: 5px; 
        }
        #results { 
            display: none; 
            width: 95%;
            max-width: 700px;        
            margin: 10px auto; 
            padding: 10px; 
            border: 2px solid #734A2E; 
            background: #fffbef; 
            color: #000; 
            font-size: 30px; 
            text-align: left; 
            border-radius: 5px; 
            white-space: pre-line;
        }

        /* Media query cho thiết bị di động */
        @media (max-width: 768px) {
            body {
                padding-bottom: 200px; /* Giảm padding-bottom cho điện thoại */
            }
            #controls {
                padding: 5px 0; /* Giảm padding */
            }
            button {
                padding: 6px 6px; /* Giảm kích thước nút */
                font-size: 20px; /* Giảm kích thước chữ */
            }
            #sentenceNumber {
                width: 40px; /* Giảm chiều rộng */
                padding: 8px; /* Giảm padding */
                font-size: 14px; /* Giảm kích thước chữ */
            }
            .optionBtn {
                font-size: 20px; /* Giảm kích thước chữ cho đáp án */
                padding: 8px; /* Giảm padding */
            }
            #infoBox {
                font-size: clamp(30px, 4vw, 40px); /* Giảm kích thước chữ */
            }
            #contactBox, #instructionBox {
                font-size: clamp(14px, 2vw, 16px); /* Giảm kích thước chữ */
            }
            #indicator {
                min-height: 40px; /* Giảm chiều cao tối thiểu */
            }
            #results, #wrongSentences, #score {
                font-size: 24px; /* Giảm kích thước chữ */
                                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="infoBox">习得越南语<br>听力练习</div>
        <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
        <div id="instructionBox">选择与播放内容相符的选项</div>
        <div id="indicator"></div>
        <div id="optionsContainer"></div>
        <div id="results"></div>
        <div id="score">0/0</div>
        <div id="wrongSentences"></div>
    </div>
    <div id="controls">
        <div>
            <button id="freeModeBtn" class="active-mode">自由模式</button>
            <button id="testModeBtn">作业模式</button>
        </div>
        <div>
            <button id="autoContinueBtn">自动继续</button>
            <button id="showHideBtn">显示-隐藏</button>
        </div>
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric" pattern="[0-9]*">
            <button id="nextBtn">▶</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>
    <audio id="mainAudio" src="audio.mp3"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>
        const audio = document.getElementById('mainAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const indicator = document.getElementById('indicator');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const replayBtn = document.getElementById('replayBtn');
        const freeModeBtn = document.getElementById('freeModeBtn');
        const testModeBtn = document.getElementById('testModeBtn');
        const autoContinueBtn = document.getElementById('autoContinueBtn');
        const showHideBtn = document.getElementById('showHideBtn');
        const scoreDisplay = document.getElementById('score');
        const wrongSentencesDisplay = document.getElementById('wrongSentences');
        const optionsContainer = document.getElementById('optionsContainer');
        const resultsDisplay = document.getElementById('results');

        const buttons = [prevBtn, nextBtn, replayBtn, freeModeBtn, testModeBtn, autoContinueBtn, showHideBtn];


const sentences = [
    {
        "audioFile": "audio.mp3",
        "start": 0.211667,
        "end": 2.321667,
        "correctAnswer": "Xin tự giới thiệu: Tôi là Lan.",
        "translation": "请允许我自我介绍：我是(阿)兰。",
        "options": [
            "Xin tự giới thiệu: Tối là Lan.",
            "Xin tự giới thiệu: Tôi là Lăn.",
            "Xin tự giới thiệu: Tôi là Lam.",
            "Xin tự giới thiệu: Tôi là Lan."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 3.451667,
        "end": 4.221667,
        "correctAnswer": "Xin.",
        "translation": "请。",
        "options": [
            "Sin.",
            "Xinh.",
            "Xín.",
            "Xin."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 4.811667,
        "end": 5.461667,
        "correctAnswer": "Tự.",
        "translation": "自。",
        "options": [
            "Tư.",
            "Tụ.",
            "Dự.",
            "Tự."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 5.931667,
        "end": 6.921667,
        "correctAnswer": "Giới thiệu.",
        "translation": "介绍。",
        "options": [
            "Dới thiệu.",
            "Giới thiểu.",
            "Giới thiệo.",
            "Giới thiệu."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 7.681667,
        "end": 8.461667,
        "correctAnswer": "Tôi.",
        "translation": "我。",
        "options": [
            "Tối.",
            "Tọi.",
            "Rôi.",
            "Tôi."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 8.911667,
        "end": 9.811667,
        "correctAnswer": "Là.",
        "translation": "是。",
        "options": [
            "Lá.",
            "La.",
            "Lạ.",
            "Là."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 10.101667,
        "end": 10.911667,
        "correctAnswer": "Lan.",
        "translation": "兰（人名）。",
        "options": [
            "Lăn.",
            "Lam.",
            "Ran.",
            "Lan."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 11.451667,
        "end": 13.461667,
        "correctAnswer": "Xin tự giới thiệu: Tôi là An.",
        "translation": "请允许我自我介绍：我是(阿)安。",
        "options": [
            "Xin tự giới thiệu: Tôi là Ân.",
            "Xin tự giới thiệu: Tối là An.",
            "Xin tự giới thiệu: Tôi là Am.",
            "Xin tự giới thiệu: Tôi là An."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 14.851667,
        "end": 17.001667,
        "correctAnswer": "Xin tự giới thiệu: Tôi là Ba.",
        "translation": "请允许我自我介绍：我是(阿)巴。",
        "options": [
            "Xin tự giới thiệu: Tôi là Pá.",
            "Xin tự giới thiệu: Tối là Ba.",
            "Xin tự giới thiệu: Tôi là Sa.",
            "Xin tự giới thiệu: Tôi là Ba."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 18.181667,
        "end": 20.401667,
        "correctAnswer": "Tôi xin tự giới thiệu: Tôi là Mai.",
        "translation": "我来做一下自我介绍：我是(阿)梅。",
        "options": [
            "Tôi xin tự giới thiệu: Tôi là Nai.",
            "Tôi xin tự giới thiệu: Tôi là Mại.",
            "Tôi xin tự giới thiệu: Tôi là Mái.",
            "Tôi xin tự giới thiệu: Tôi là Mai."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 22.151667,
        "end": 24.451667,
        "correctAnswer": "Tôi xin tự giới thiệu: Tôi là Na.",
        "translation": "我来做一下自我介绍：我是(阿)娜。",
        "options": [
            "Tôi xin tự giới thiệu: Tôi là La.",
            "Tôi xin tự giới thiệu: Tôi là Nạ.",
            "Tôi xin tự giới thiệu: Tôi là Ná.",
            "Tôi xin tự giới thiệu: Tôi là Na."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 25.021667,
        "end": 27.141667,
        "correctAnswer": "Tôi xin tự giới thiệu: Tôi là Thu.",
        "translation": "我来做一下自我介绍：我是(阿)秋。",
        "options": [
            "Tôi xin tự giới thiệu: Tôi là Su.",
            "Tôi xin tự giới thiệu: Tôi là Thư.",
            "Tôi xin tự giới thiệu: Tối là Thu.",
            "Tôi xin tự giới thiệu: Tôi là Thu."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 27.621667,
        "end": 29.791667,
        "correctAnswer": "Xin giới thiệu với anh: Đây là Sơn.",
        "translation": "向你介绍一下：这是(阿)山。",
        "options": [
            "Xin giới thiệu với anh: Đây là Sân.",
            "Xin giới thiệu với ảnh: Đây là Sơn.",
            "Xin giới thiệu với anh: Đây là Sờn.",
            "Xin giới thiệu với anh: Đây là Sơn."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 30.331667,
        "end": 31.101667,
        "correctAnswer": "Với.",
        "translation": "和；与。",
        "options": [
            "Vơi.",
            "Vởi.",
            "Bới.",
            "Với."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 31.541667,
        "end": 32.221667,
        "correctAnswer": "Anh.",
        "translation": "哥哥；先生。",
        "options": [
            "Ảnh.",
            "Ánh.",
            "Oanh.",
            "Anh."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 32.741667,
        "end": 33.811667,
        "correctAnswer": "Đây là.",
        "translation": "这是。",
        "options": [
            "Đây lả.",
            "Đây nà.",
            "Dây là.",
            "Đây là."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 34.341667,
        "end": 34.991667,
        "correctAnswer": "Chị.",
        "translation": "姐姐；女士（对女性的称呼）。",
        "options": [
            "Chí.",
            "Chịu.",
            "Trị.",
            "Chị."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 35.351667,
        "end": 36.051667,
        "correctAnswer": "Em.",
        "translation": "弟弟／妹妹；我（对比自己年龄稍大的人的自称）。",
        "options": [
            "Yêm.",
            "En.",
            "Emm.",
            "Em."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 36.501667,
        "end": 37.161667,
        "correctAnswer": "Ông.",
        "translation": "爷爷；先生。",
        "options": [
            "Ôn.",
            "Đông.",
            "Ôm.",
            "Ông."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 37.701667,
        "end": 38.451667,
        "correctAnswer": "Bà.",
        "translation": "奶奶；女士。",
        "options": [
            "Bá.",
            "Bả.",
            "Bạ.",
            "Bà."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 38.981667,
        "end": 39.721667,
        "correctAnswer": "Thầy.",
        "translation": "老师（男性）。",
        "options": [
            "Thay.",
            "Tầy.",
            "Thời.",
            "Thầy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 40.221667,
        "end": 40.961667,
        "correctAnswer": "Cô.",
        "translation": "老师（女性）；阿姨。",
        "options": [
            "Cố.",
            "Go.",
            "Co.",
            "Cô."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 41.921667,
        "end": 44.251667,
        "correctAnswer": "Xin giới thiệu với chị: Đây là Tài.",
        "translation": "向你介绍一下：这是(阿)才。",
        "options": [
            "Xin giới thiệu với chị: Đây là Tày.",
            "Xin giới thiệu với chị: Đây là Cai.",
            "Xin giới thiệu với chị: Đây là Tái.",
            "Xin giới thiệu với chị: Đây là Tài."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 44.771667,
        "end": 46.901667,
        "correctAnswer": "Xin giới thiệu với ông: Đây là Long.",
        "translation": "向您介绍一下：这是(阿)龙。",
        "options": [
            "Xin giới thiệu với ông: Đây là Rông.",
            "Xin giới thiệu với ông: Đây là Lón.",
            "Xin giới thiệu với ông: Đây là Lông.",
            "Xin giới thiệu với ông: Đây là Long."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 47.521667,
        "end": 48.851667,
        "correctAnswer": "Em chào thầy ạ.",
        "translation": "老师您好。",
        "options": [
            "Em chào thày ạ.",
            "Em chào thay ạ.",
            "Em chào thầy à.",
            "Em chào thầy ạ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 49.271667,
        "end": 50.111667,
        "correctAnswer": "Chào.",
        "translation": "你好；问候。",
        "options": [
            "Trào.",
            "Chạu.",
            "Cháo.",
            "Chào."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 50.541667,
        "end": 51.241667,
        "correctAnswer": "ạ.",
        "translation": "（表示礼貌的语气词）。",
        "options": [
            "à.",
            "ả.",
            "ã.",
            "ạ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 51.701667,
        "end": 54.271667,
        "correctAnswer": "Em chào cô ạ. Cô có khỏe không ạ?",
        "translation": "老师您好。您身体好吗？",
        "options": [
            "Em chào cô ạ. Cô có khoẻ khôn ạ?",
            "Em chào cô ạ. Cô có khẻ không ạ?",
            "Em chào cô ạ. Cô co khỏe không ạ?",
            "Em chào cô ạ. Cô có khỏe không ạ?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 55.801667,
        "end": 56.551667,
        "correctAnswer": "Khỏe.",
        "translation": "健康。",
        "options": [
            "Khẻ.",
            "Khóe.",
            "Khoẻ.",
            "Khỏe."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 57.051667,
        "end": 58.161667,
        "correctAnswer": "Chào bà ạ.",
        "translation": "奶奶您好。",
        "options": [
            "Chào bả ạ.",
            "Chào bá ạ.",
            "Chào bà à.",
            "Chào bà ạ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 58.691667,
        "end": 60.851667,
        "correctAnswer": "Chào ông ạ. Ông có khỏe không?",
        "translation": "爷爷您好。您身体好吗？",
        "options": [
            "Chào ông ạ. Ông có khoẻ khôn?",
            "Chào ông ạ. Ôn có khỏe không?",
            "Chào ông ạ. Ông có khẻ không?",
            "Chào ông ạ. Ông có khỏe không?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 62.801667,
        "end": 65.351667,
        "correctAnswer": "Chào bác ạ. Bác có khỏe không ạ?",
        "translation": "伯伯您好。您身体好吗？",
        "options": [
            "Chào bạc ạ. Bác có khỏe không ạ?",
            "Chào bác ạ. Bác có khẻ không ạ?",
            "Chào bác ạ. Bác có khỏa không ạ?",
            "Chào bác ạ. Bác có khỏe không ạ?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 65.801667,
        "end": 66.951667,
        "correctAnswer": "Chào chú ạ.",
        "translation": "叔叔您好。",
        "options": [
            "Chào chũ ạ.",
            "Chào chụ ạ.",
            "Chào cú ạ.",
            "Chào chú ạ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 67.371667,
        "end": 69.171667,
        "correctAnswer": "Rất vui được làm quen với bạn.",
        "translation": "很高兴认识你。",
        "options": [
            "Rất vui được làm khoen với bạn.",
            "Rất vui được làm quen với vạn.",
            "Rất vui được làm quen vối bạn.",
            "Rất vui được làm quen với bạn."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 69.691667,
        "end": 70.301667,
        "correctAnswer": "Rất.",
        "translation": "很；非常。",
        "options": [
            "Rết.",
            "Rát.",
            "Dất.",
            "Rất."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 70.831667,
        "end": 71.551667,
        "correctAnswer": "Vui.",
        "translation": "高兴；开心。",
        "options": [
            "Vuy.",
            "Vụi.",
            "Bui.",
            "Vui."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 72.061667,
        "end": 72.741667,
        "correctAnswer": "Được.",
        "translation": "能；能够；可以；得到。",
        "options": [
            "Đướk.",
            "Đước.",
            "Dược.",
            "Được."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 73.191667,
        "end": 74.281667,
        "correctAnswer": "Làm quen.",
        "translation": "认识；结识。",
        "options": [
            "Lằm quen.",
            "Làm quên.",
            "Lam quen.",
            "Làm quen."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 74.881667,
        "end": 76.731667,
        "correctAnswer": "Rất vui được làm quen với em.",
        "translation": "很高兴认识你(对比自己年龄稍小的人)。",
        "options": [
            "Rất vui được làm quen vói em.",
            "Rất vui được lam quen với em.",
            "Rất vui được làm quên với em.",
            "Rất vui được làm quen với em."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 78.081667,
        "end": 79.441667,
        "correctAnswer": "Rất vui được gặp anh.",
        "translation": "很高兴见到你（对比自己年龄稍大的男性,或纯属礼貌）。",
        "options": [
            "Rất vui được gặp ạnh.",
            "Rất vui được gập anh.",
            "Rất vui được gặp ánh.",
            "Rất vui được gặp anh."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 81.591667,
        "end": 82.191667,
        "correctAnswer": "Gặp.",
        "translation": "见, 碰见, 见面。",
        "options": [
            "Gạp.",
            "Gắp.",
            "Gập.",
            "Gặp."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 82.801667,
        "end": 84.221667,
        "correctAnswer": "Rất vui được gặp chị.",
        "translation": "很高兴见到你（对女士）。",
        "options": [
            "Rất vui được gặp chi.",
            "Rất vui được gạp chị.",
            "Rất vui được gặp chít.",
            "Rất vui được gặp chị."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 85.041667,
        "end": 86.411667,
        "correctAnswer": "Rất vui được gặp ông.",
        "translation": "很高兴见到您（对年长男性,或纯属礼貌）。",
        "options": [
            "Rất vui được gập ông.",
            "Rất vui được gặp ổng.",
            "Rất vui được gặp ôngg.",
            "Rất vui được gặp ông."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 86.971667,
        "end": 88.401667,
        "correctAnswer": "Rất vui được gặp bà.",
        "translation": "很高兴见到您（对年长女性, 或纯属礼貌）。",
        "options": [
            "Rất vui được gập bà.",
            "Rất vui được gặp bả.",
            "Rất vui được gạp bà.",
            "Rất vui được gặp bà."
        ]
    }
];

        let currentIndex = 0;
        let isFreeMode = true;
        let correctCount = 0;
        let isPlaying = false;
        let correctSentences = new Set();
        let wrongSentences = new Set();
        let autoContinue = false;
        let showAnswer = false;
        let userAnswers = [];

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function init() {
            updateSentenceDisplay();
        }

        function updateSentenceDisplay() {
            sentenceNumber.value = currentIndex + 1;
            indicator.style.background = '#ffffe0';
            if (isFreeMode && showAnswer) {
                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #85ae5f;">${sentences[currentIndex].translation}</div>
                `;
            } else {
                indicator.innerHTML = '';
            }
            updateOptions();
            if (!isFreeMode) updateScore();
        }

        function updateOptions() {
            optionsContainer.innerHTML = '';
            const shuffledOptions = shuffleArray(sentences[currentIndex].options);
            shuffledOptions.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'optionBtn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(btn);
            });
        }

        function playCurrentSentence() {
            if (isPlaying) audio.pause();
            buttons.forEach(btn => btn.classList.add('disabled'));
            sentenceNumber.disabled = true;
            isPlaying = true;
            audio.src = sentences[currentIndex].audioFile;
            audio.currentTime = sentences[currentIndex].start;
            audio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Vui lòng nhấn nút “再听一遍” để phát âm thanh.');
                buttons.forEach(btn => btn.classList.remove('disabled'));
                sentenceNumber.disabled = false;
                isPlaying = false;
            });

            audio.ontimeupdate = () => {
                if (audio.currentTime >= sentences[currentIndex].end) {
                    audio.pause();
                    audio.ontimeupdate = null;
                    buttons.forEach(btn => btn.classList.remove('disabled'));
                    sentenceNumber.disabled = false;
                    isPlaying = false;
                }
            };
        }

        function moveSentence(direction) {
            currentIndex = (currentIndex + direction + sentences.length) % sentences.length;
            updateSentenceDisplay();
            playCurrentSentence();
        }

        function checkAnswer(selectedAnswer) {
            const correctAnswer = sentences[currentIndex].correctAnswer;
            const optionButtons = optionsContainer.getElementsByClassName('optionBtn');
            
            // Clear previous styles
            for (let btn of optionButtons) {
                btn.classList.remove('correct', 'wrong');
                btn.disabled = !isFreeMode; // Only disable buttons in Test Mode
            }

            // Find and style the selected button
            for (let btn of optionButtons) {
                if (btn.textContent === selectedAnswer) {
                    if (selectedAnswer === correctAnswer) {
                        indicator.style.background = '#B7D7AA';
                                                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #000000;">${sentences[currentIndex].translation}</div>
                `;
                        btn.classList.add('correct');
                        correctAudio.play().catch(error => {
                            console.error('Correct audio playback failed:', error);
                        });
                    } else {
                        indicator.style.background = '#CE6D5E';
                                                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #000000;">${sentences[currentIndex].translation}</div>
                `;
                        btn.classList.add('wrong');
                        wrongAudio.play().catch(error => {
                            console.error('Wrong audio playback failed:', error);
                        });
                    }
                }
            }

            if (!isFreeMode) {
                userAnswers[currentIndex] = selectedAnswer;
                if (selectedAnswer === correctAnswer && !correctSentences.has(currentIndex)) {
                    correctCount++;
                    correctSentences.add(currentIndex);
                    wrongSentences.delete(currentIndex);
                } else if (selectedAnswer !== correctAnswer && !correctSentences.has(currentIndex)) {
                    wrongSentences.add(currentIndex);
                }
                updateScore();

                // Auto-move to next sentence in Test Mode
                const audioToWait = (selectedAnswer === correctAnswer) ? correctAudio : wrongAudio;
                audioToWait.onended = () => {
                    if (userAnswers.length === sentences.length) {
                        showResults();
                    } else {
                        setTimeout(() => {
                            moveSentence(1);
                        }, 200);
                    }
                };
            } else if (isFreeMode && autoContinue && selectedAnswer === correctAnswer) {
                // Auto-move in Free Mode only if answer is correct and autoContinue is enabled
                correctAudio.onended = () => {
                    setTimeout(() => {
                        moveSentence(1);
                    }, 200);
                };
            } else {
                correctAudio.onended = null;
                wrongAudio.onended = null;
            }
        }

        function updateScore() {
            scoreDisplay.textContent = `${correctCount}/${sentences.length}`;
            scoreDisplay.style.display = 'block'; // Hiển thị score trong Test Mode
        }

        function showResults() {
            let resultText = `练习完成！\n正确答案数量：${correctCount}/${sentences.length}\n正确率：${((correctCount / sentences.length) * 100).toFixed(2)}%\n错误题目：`;
            wrongSentences.forEach(index => {
                resultText += `\n第${index + 1}题：\n你的选择：${userAnswers[index] || '未选择'}\n正确答案：${sentences[index].correctAnswer}\n`;
            });
            if (wrongSentences.size === 0) {
                resultText += '\n全部正确！';
            }
            resultsDisplay.textContent = resultText;
            resultsDisplay.style.display = 'block';
        }

        prevBtn.onclick = () => {
            moveSentence(-1);
        };

        nextBtn.onclick = () => {
            moveSentence(1);
        };

        replayBtn.onclick = () => {
            playCurrentSentence();
        };

        freeModeBtn.onclick = () => {
            isFreeMode = true;
            freeModeBtn.classList.add('active-mode');
            testModeBtn.classList.remove('active-mode');
            autoContinueBtn.disabled = false;
            autoContinueBtn.classList.remove('disabled');
            showHideBtn.disabled = false;
            showHideBtn.classList.remove('disabled');
            scoreDisplay.style.display = 'none';
            wrongSentencesDisplay.style.display = 'none';
            resultsDisplay.style.display = 'none';
            updateSentenceDisplay();
        };

        testModeBtn.onclick = () => {
            isFreeMode = false;
            testModeBtn.classList.add('active-mode');
            freeModeBtn.classList.remove('active-mode');
            autoContinueBtn.disabled = true;
            autoContinueBtn.classList.add('disabled');
            showHideBtn.disabled = true;
            showHideBtn.classList.add('disabled');
            showHideBtn.classList.remove('active-mode');
            showAnswer = false;
            scoreDisplay.style.display = 'block';
            currentIndex = 0;
            correctCount = 0;
            correctSentences.clear();
            wrongSentences.clear();
            userAnswers = [];
            for (let i = 0; i < sentences.length; i++) {
                wrongSentences.add(i);
            }
            updateSentenceDisplay();
        };

        autoContinueBtn.onclick = () => {
            if (isFreeMode) {
                autoContinue = !autoContinue;
                autoContinueBtn.classList.toggle('active-mode');
                if (!autoContinue) {
                    correctAudio.onended = null;
                }
            }
        };

        showHideBtn.onclick = () => {
            if (isFreeMode) {
                showAnswer = !showAnswer;
                showHideBtn.classList.toggle('active-mode');
                updateSentenceDisplay();
            }
        };

        sentenceNumber.onchange = () => {
            if (!isPlaying) {
                const num = parseInt(sentenceNumber.value) - 1;
                if (!isNaN(num) && num >= 0 && num < sentences.length) {
                    currentIndex = num;
                    updateSentenceDisplay();
                    playCurrentSentence();
                } else {
                    alert(`输入范围： 1 到 ${sentences.length}`);
                    updateSentenceDisplay();
                }
            }
        };

        sentenceNumber.onkeydown = (e) => {
            if (!isPlaying) {
                if (e.key === 'ArrowLeft') {
                    moveSentence(-1);
                }
                if (e.key === 'ArrowRight') {
                    moveSentence(1);
                }
            }
        };

        init();
    </script>
</body>
</html>
